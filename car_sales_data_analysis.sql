CREATE DATABASE steve_cars;
use steve_cars;
use db1;
CREATE table sales (
sale_id INT,
car_id INT,
salesman_id INT,
purchase_date DATETIME
);
INSERT INTO sales(sale_id,car_id,salesman_id,purchase_date)
VALUES
(1,2,2,"2021-01-01"),(2,3,3,"2021-01-01"),(3,2,2,"2021-01-01"),(4,5,4,"2021-01-01"),(5,8,1,"2021-01-01"),
(6,2,1,"2021-01-01"),(7,4,2,"2021-01-01"),(8,5,3,"2021-01-01"),(9,2,4,"2022-01-01"),(10,1,3,"2022-01-01"),
(11,8,2,"2022-01-01"),(12,7,2,"2022-01-01"),(13,5,3,"2022-01-01"),(14,3,1,"2022-01-01"),(15,5,4,"2022-01-01"),
(16,1,2,"2022-01-01"),(17,2,3,"2023-01-01"),(18,6,3,"2023-01-01"),(19,7,1,"2023-01-01"),(20,4,4,"2023-01-01");

CREATE TABLE cars(
car_id INT,
make varchar(50),
type VARCHAR(50),
style VARCHAR(50),
cost INT
);
INSERT INTO cars(car_id,make,type,style,cost)
VALUES
(1,'Honda','civic','sedan',30000),(2,'Toyta','corolla','Hatchback',25000),(3,'Ford','Explorer','SUV',40000),(4,'Chevrolet','Camaro','Coupe',36000),
(5,'BMW','x5','SUV',55000),(6,'Audi','A4','sedan',48000),(7,'Mercedes','C-class','Coupe',60000),(8,'Nissan','Altima','sedan',26000);


CREATE TABLE salesperson ( 
salesman_id INT,name VARCHAR(50), age INT, city VARCHAR(50)
);
INSERT INTO salesperson(salesman_id,name,age,city)
VALUES (1,'John Smith',28,'New York'),(2,"Emily Wong",35,"San Fran"),
(3,'Tom Lee',42,'Seattle'),(4,'Lucy Chen',31,'LA');

SELECT * FROM sales;
SELECT * FROM cars;
SELECT * FROM salesperson;

/* Q1 WHat are the details of all cars purchased in the year 2022? */
SELECT c.make,c.type,c.style,c.cost,
s.purchase_date
from cars as c
INNER JOIN sales as s
ON c.car_id=s.car_id
WHERE  year(s.purchase_date)='2022';

/* Q2 What is the total number of cars sold by each sale person */

SELECT s.name,COUNT(p.car_id) from salesperson as s
INNER JOIN sales as p 
ON s.salesman_id=p.salesman_id 
GROUP BY s.name

/* Q3 What is Total Revenue generatedby each salesperson */
SELECT * FROM sales;
SELECT * FROM cars;
SELECT * FROM salesperson;

select sp.name, SUM(c.cost) AS Total_revenue
from salesperson as sp
JOIN sales as s 
ON
sp.salesman_id=s.salesman_id
JOIN cars c on s.car_id=c.car_id
GROUP BY sp.name
order by Total_revenue;

/* Q4 What are the details of the cars sold by each salesperson */

select sp.salesman_id,sp.name,c.car_id,c.make,c.style,c.type,c.cost
from sales as s
JOIN salesperson as sp ON s.salesman_id=sp.salesman_id
JOIN  cars as c ON c.car_id=s.car_id
group by sp.salesman_id,sp.name,c.car_id,c.make,c.style,c.type,c.cost
ORDER BY sp.salesman_id;

/* Q5 What is the total revenue generated by each car type */

select c.type,c.car_id,SUM(c.cost) as type_revenu from cars as c
JOIN sales as s ON s.car_id = c.car_id
GROUP BY c.type,c.car_id
order BY c.car_id;

/* Q6 What are the details of the cars sold in the year 2021 bt salesperson 'Emily Wong'? */
select s.car_id,c.make,c.type,c.style,c.cost
FROM sales s
JOIN salesperson as sp ON sp.salesman_id=s.salesman_id
JOIN cars c ON c.car_id=s.car_id
WHERE sp.name="Emily Wong" and YEAR(s.purchase_date)=2021
group by sp.name,s.car_id,c.make,c.style,c.type,c.cost

/* Q7 What is the total revenue Generated by the sales pf hatchback cars ? */

 SELECT c.style,SUM(c.cost) AS Hatchback_Revenue FROM sales s
 JOIN cars as c 
 ON c.car_id=s.car_id
 where c.style="Hatchback"
 group by c.style
 
 /* Q8 What is the Total revenue Generated by the sales ofSUV cars in the year of 2022 */

SELECT c.style ,SUM(c.cost) as suv_revenu
FROM sales as s
JOIN cars  c
ON c.car_id=s.car_id
WHERE c.style="SUV" and YEAR(s.purchase_date)='2022'
GROUP BY c.style
 
/* Q9 What is the name and city of the salesperson who sold the most number of cars in the year 2023 */
select * from cars
select * from sales
select * from salesperson
with cte as(
select 
	sp.name,
	sp.city,
	COUNT(s.car_id) as car_sell,
ROW_NUMBER() OVER(order by count(s.car_id) DESC ) as rnk
FROM sales s
JOIN salesperson sp ON s.salesman_id=sp.salesman_id
where year(purchase_date)=2023
GROUP BY sp.name ,sp.city
)
select name,city ,car_sell from cte
where rnk=1